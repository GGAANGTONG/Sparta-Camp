<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Single+Day&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: rgb(192, 211, 222);
            font-family: 'Pacifico', cursive;
            font-family: 'Single Day', cursive;
        }

        .card {
            height: 100%;
            background-color: rgb(77, 103, 219);
        }

        #title {
            width: 100%;
            background-image: url(https://media.istockphoto.com/id/1090388858/ko/%EC%82%AC%EC%A7%84/%EC%B9%B4%EB%A9%94%EB%9D%BC%EB%8A%94-%EC%9D%B4%EB%B2%A4%ED%8A%B8%EC%9D%98-%EA%B7%B8%EB%A3%B9%EC%9D%98-%EC%8B%A4%EB%A3%A8%EC%97%A3.jpg?s=2048x2048&w=is&k=20&c=VuGE2L1MRYBrCYRZa8kaN2glHPx4fE50B8TbFjxOKP4=);
            background-position: center;
            background-size: cover;
        }

        #cards {
            width: 95%;
            margin: 5px auto 5px auto;
        }

        #movieFinderHouse {
            width: 45%
        }
    </style>
</head>

<body>
    <div>
        <nav>
            <div class=" mb-4 bg-body-tertiary" id="title">
                <div class="container-fluid py-5">
                    <h1 class="display-5 fw-bold" style="color: white;">명작 영화 관람소</h1>
                    <p class="col-md-8 fw-bold fs-4" style=" color: white;">전 세계에서 모인 최고 명작 영화들! 이 안에 보고 싶은게 반드시 있을 겁니다!
                    </p>
                    <div class="input-group mb-3" id="movieFinderHouse">
                        <button class="btn btn-secondary" type="button" id="movieFinder1" style="font-weight: bold;">영화 검색</button>
                        <input type="text" class="form-control" placeholder="좋아하는 영화를 검색해 보세요!"
                            aria-label="Example text with button addon" aria-describedby="button-addon1"
                            id="wordFilter">
                    </div>
                    <p><button type="button" class="btn btn-secondary" id="movieChanger" style="font-weight: bold;">인기 영화 관람</button></p>
                    <p><button type="button" class="btn btn-secondary" id="goToFirstPage" style="font-weight: bold;">처음 페이지로</button></p>

                </div>
            </div>
    </div>
    </nav>

    <div class="row row-cols-1 row-cols-md-4 g-4" id="cards">

        <script>
            //API에 필요한 options 상수 정의 (fetch쓸 때 api, options, url 들어감)
            const options = {
                method: 'GET',
                headers: {
                    accept: 'application/json',
                    Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJjZTkxOWU0YzFkZGYzOTdjMjIzMjNkNzJiNjRkYjZjZCIsInN1YiI6IjY1OThkMGMwMWQxYmY0MDE0ZDIyZDFkNSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.13Uig7dMzOVBHUoAiuiUr2YR-TK3c5pjMPcK98AOs1Y'
                }
            };

            //JS 부분은 가장 밑에 오는 것이 좋음(HTML문서는 코드를 위에서 아래로 순서대로 읽기 때문에, 생성 부분을 생성에 필요한 제반조건보다 먼저 읽어 버릴 수도 있음)
            //configuration API
            fetch('https://api.themoviedb.org/3/configuration', options)
                .then(response => response.json())
                .then(config => {
                    //영화 정보 API, 근데 왜 configuration API 하위에 영화 정보 API가 들어갈까? 영화 정보 API가 더 크지 않나?
                    //Chat gpt: 구성 API는 영화와 관련된 이미지를 애플리케이션에서 올바르게 표시하기 위해 이미지의 기본 URL 및 크기를 구성하는 중요한 정보를 제공하므로 영화 정보에 대한 요청을 수행하기 전에 이 정보를 가져와야 합니다.
                    fetch('https://api.themoviedb.org/3/movie/top_rated?language=en-US&page=1', options)
                        .then(response => response.json())
                        .then(response => {
                            let data = response.results;
                            let temp_html = '';
                            // let id = ''; << 불필요했음, 혹시나 해서 넣어 뒀는데
                            data.forEach(card => {
                                let poster_path = card.poster_path;
                                let title = card.title;
                                let overview = card.overview;
                                let vote_average = card.vote_average;
                                let id = card.id;

                                let poster_url =
                                    `${config.images.base_url}${config.images.poster_sizes[3]}${poster_path}
                                    `;
                                //위에 세 요소는 붙어 있어야 함(마치 www.naver.com/image(baseurl) image_size==2(poster_sizes)&name==spongebob(poster_path))

                                //+=안하면 카드가 하나만 나옴
                                //이를 통해 temp_html에 .cards의 정보를 루프 돌리며 쌓음
                                //d-flex flex-column h-100 넣으니까 세로 길이 통일댐
                                //<div class="card h-100"> 이게 안된 이유는 카드 내부 콘텐츠가 모두 숨겨진 상태로 될 가능성이 있데
                                //<style>에 넣으니까 잘되네
                                temp_html += `   
                                    <div class="col">
                                    <div class="card h-100" type = "Button" onclick = "showDetails(${id})" style = >
                                    <img src= ${poster_url} class="card-img-top" alt="...">
                                    <div class= "card-body h-100" >
                                        <h5 class="card-title">${title}</h5>
                                        <p class="card-text">${overview}</p>
                                        <p class="card-text">${vote_average}</p>
                                        </div>
                                        </div>
                                        </div>
                                    `;
                            });
                            document.getElementById('cards').innerHTML = temp_html;
                            //쌓인 temp_html 정보를 inner.HTML을 활용하여 웹 브라우저 상에 표현함
                        });
                })
                .catch(err => console.error(err))


            //shoDetails 함수의 id 변수는 temp_html의 onclick = "showDetails(${id})"와 연결되어 있고, "showDetails(${id})"의 id는 forEach 메서드 내의 let id = card.id의 id 이다.
            function showDetails(id) {
                alert(`ID는 ${id}입니다.`)
            };

            //addEventListener은 getElementById등과 사용 가능, addEventListener의 event type은 ""로 스트링 타입으로 넣더라.
            document.getElementById('wordFilter').addEventListener("keydown", function (event) {
                //Enter가 문자열로 들어갔는데 왜 작동할까?
                if (event.key === "Enter") {
                    let forFiltering = document.getElementById('wordFilter').value.toLowerCase();

                    let cards = document.querySelectorAll('.card');


                    let filteredCards = Array.from(cards).filter(card => card.innerText.toLowerCase().includes(forFiltering));\
                //card 를 card.querySelector('.card-title')로 바꿔야댐, 제목만 필터링 할려면


                    cards.forEach(card => {
                        card.style.display = filteredCards.includes(card) ? 'block' : 'none';
                    });
                }
            });



            document.getElementById('movieFinder1').addEventListener("click", function () {
                //txt 입력 란에 id 값을 줘서 입력 란에 작성된 텍스트 값을 가져옴 (jquery랑 value 값 호출하는 방식이 다름 주의) 
                let forFiltering = document.getElementById('wordFilter').value.toLowerCase(); // toLowerCase가 있어서 대소문자 구분 없이 작동
                //card 클래스에 속한 모든 영화 정보 가져오기
                let cards = document.querySelectorAll('.card');

                //chat gpt: 
                // Array.from(cards)는 유사 배열 객체나 반복 가능한 객체를 일반 배열로 변환하는 메서드입니다. 이 메서드를 사용하면 배열 메서드를 적용할 수 있는 일반 배열을 얻을 수 있습니다.
                // document.querySelectorAll('.card')로 선택한 결과는 NodeList 형태로 반환됩니다. NodeList는 일반적인 배열이 아니기 때문에 배열 메서드를 직접 적용할 수 없습니다. 따라서 Array.from()을 사용하여 NodeList를 배열로 변환하여 배열 메서드를 사용할 수 있도록 합니다.
                let filteredCards = Array.from(cards).filter(card => card.innerText.toLowerCase().includes(forFiltering));

                //chat gpt: Nodelist는 배열과 유사하게 반복 가능한(iterable) 객체라서 Array.from을 사용하지 않고도 forEach를 직접 사용할 수 있다고 함.
                //card.style.display는 DOM 요소의 CSS display 속성을 설정하거나 가져올 수 있음.
                //? 다음은 true case result or false case result 고, block = 화면에 보임, none = 화면에서 감춰짐 
                cards.forEach(card => {
                    card.style.display = filteredCards.includes(card) ? 'block' : 'none';
                });
            });
            document.getElementById('movieFinder1').addEventListener("click", function () {

            });
            document.addEventListener('DOMContentLoaded', function () {
                // 페이지가 로드되면 실행될 코드
                var searchInput = document.getElementById('wordFilter');
                //#, . 같은 애들은 CSS 식별자로서 쓰는 거 JS에선 이름만 넣어야 함
                // 검색 입력란에 포커스를 줌
                searchInput.focus();

                // 페이지 로드 후 검색 입력란에 미리 정의된 텍스트를 넣고 싶다면 아래 코드 사용
                // searchInput.value = "미리 정의된 텍스트";
                //이거 근데 커서가 안움직이는데
            });

            document.getElementById('movieFinder1').addEventListener("click", function () {
                if (document.getElementById('wordFilter').value === null) {
                    location.reload() //document.window.reload(); 가 아니네...
                }
            });

            document.getElementById('wordFilter').addEventListener("keydown", function (event) {
                //Enter가 문자열로 들어갔는데 왜 작동할까?
                if (event.key === "Enter" && document.getElementById('wordFilter').value === null) {
                    location.reload();
                }
            });

        </script>

        <script>
            function movieChanging() {
                fetch('https://api.themoviedb.org/3/configuration', options)
                    .then(response => response.json())
                    .then(config => {
                        fetch('https://api.themoviedb.org/3/movie/popular?language=en-US&page=1', options)
                            .then(response => response.json())
                            .then(response => {
                                let data = response.results;
                                let temp_html = '';
                                // let id = ''; << 불필요했음, 혹시나 해서 넣어 뒀는데
                                data.forEach(card => {
                                    let poster_path = card.poster_path;
                                    let title = card.title;
                                    let overview = card.overview;
                                    let vote_average = card.vote_average;
                                    let id = card.id;

                                    let poster_url =
                                        `${config.images.base_url}${config.images.poster_sizes[3]}${poster_path}
                                    `;
                                    //위에 세 요소는 붙어 있어야 함(마치 www.naver.com/image(baseurl) image_size==2(poster_sizes)&name==spongebob(poster_path))

                                    //+=안하면 카드가 하나만 나옴
                                    //이를 통해 temp_html에 .cards의 정보를 루프 돌리며 쌓음
                                    temp_html += `   
                                    <div class="col">
                                    <div class="card" type = "Button" onclick = "showDetails(${id})">
                                    <img src= ${poster_url} class="card-img-top" alt="...">
                                    <div class= "card-body" >
                                        <h5 class="card-title">${title}</h5>
                                        <p class="card-text">${overview}</p>
                                        <p class="card-text">${vote_average}</p>
                                        </div>
                                        </div>
                                        </div>
                                    `;
                                });
                                document.getElementById('cards').innerHTML = temp_html;
                                //쌓인 temp_html 정보를 inner.HTML을 활용하여 웹 브라우저 상에 표현함
                            });

                    })
                    .catch(err => console.error(err));
            };
            document.getElementById('movieChanger').addEventListener("click", movieChanging); //movieChanging()을 넣으면 그냥 실행 된 상태로 유지됨
            document.getElementById('goToFirstPage').addEventListener("click", function () {
                location.reload();
            })
            //겁나 신기한게, 얘를 누르면 아예 첫페이지로 가버리는데, 위에 있는 location.reload()가 걸린 애들을 누르면 그 페이지 안에서만 초기화된다.
        </script>
    </div>
    </div>

</body>

</html>